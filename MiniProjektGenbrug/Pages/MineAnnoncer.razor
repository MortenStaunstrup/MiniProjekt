@page "/mineannoncer"
@using Blazored.LocalStorage
@using Core
@using MiniProjektGenbrug.Services.Interfaces
@inject IUserService userService
@inject NavigationManager navMan
@inject ILocalStorageService localStorage
@inject IProductService productService

<PageTitle>Dine Annoncer</PageTitle>

<h1>Dine Annoncer</h1>

@if (_dineAnnoncer == null)
{
    <p><i>...loading dine annoncer</i></p>
}
else
{
    <ul>
        @foreach (var annonce in _dineAnnoncer)
        {
            <li>
                <div class="listItem">
                    <div class="pictureDiv">
                        <img src="data:image/jpg;base64,@annonce.Picture" alt="Picture of Item"/>
                    </div>
                    <div class="infoDiv">
                        <span class="productNameClass">@annonce.Productname</span>
                        <hr/>
                        <p>@annonce.Description</p>
                        <ul class="specsList">
                            <li>Type: @annonce.Category</li>
                            <li>Farve: @annonce.Color</li>
                            <li>Størrelse: @annonce.Size</li>
                        </ul>
                        <span class="statusClass">Status: @annonce.Status</span>
                        <span class="priceClass">@annonce.Price</span>
                        <button class="buttonClass">Rediger</button>
                    </div>
                </div>
            </li>
        }
    </ul>
    <button class="cssbuttons-io-button">
        <svg
            height="24"
            width="24"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path d="M0 0h24v24H0z" fill="none"></path>
            <path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z" fill="currentColor"></path>
        </svg>
        <span>Tilføj ny Annonce</span>
    </button>
}


@code {
    
    User? currentUser;
    List<Product>? _dineAnnoncer;

    protected override async Task OnInitializedAsync()
    {
        // Test kode
        var theUser = await userService.GetUserById(1);
        var theDataSavedInLocalstorage = new User()
        {
            id = theUser.id,
            Username = theUser.Username
        };
        await localStorage.SetItemAsync("user",theDataSavedInLocalstorage);
        //
        currentUser = await userService.GetUserLoggedIn();
        if (currentUser == null)
        {
            navMan.NavigateTo("login");
        }
        
        // Test kode, giver alle produkter ikke kun brugers !!!!!!
        _dineAnnoncer = await productService.GetProductsById();
    }

}