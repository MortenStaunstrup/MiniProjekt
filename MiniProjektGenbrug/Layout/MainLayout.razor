@inherits LayoutComponentBase
@using MiniProjektGenbrug.Services.Interfaces
@inject IProductService ProductService
@using Core

<div class="page">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main id="main">
        <div id="checkud" @onclick="ToggleCartPanel">
            <i class="fa fa-shopping-cart" style="font-size:36px"></i>
            <div id="indkøbstal"><p id="tal">@cartItems.Count</p></div>
        </div>

        @if (show)
        {
            <div class="cart-panel">
                <button class="close-button" @onclick="ToggleCartPanel">×</button>
                <h4>Min Anmodningskurv</h4>

                @if (cartItems.Any())
                {
                    <ul>
                        @foreach (var product in cartItems)
                        {
                            <li style="display: flex; justify-content: space-between; align-items: center;">
                                <span>@product.Productname - @product.Price.ToString("C")</span>
                                @if (isEditing)
                                {
                                    <button class="delete-button" @onclick="() => RemoveFromCart(product)">Slet</button>
                                }
                            </li>
                        }
                    </ul>
                }
                else
                {
                    <p>Kurven er tom</p>
                }

                <div class="buttons-container">
                    <button @onclick="ToggleEditMode">@((isEditing ? "Stop redigering" : "Rediger"))</button>
                    <button class="checkout-button">Gå til betaling</button>
                </div>
            </div>
        }

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

@code {
    private bool show = false;
    private bool isEditing = false;

    private List<Product> cartItems = new()
    {
        new Product { Productname = "Eksempel", Price = 99.99 }
    };

    private void ToggleCartPanel()
    {
        show = !show;
        Console.WriteLine($"Cartpanel vises: {show}");
    }

    private void ToggleEditMode()
    {
        isEditing = !isEditing;
        StateHasChanged();
    }

    private void RemoveFromCart(Product product)
    {
        cartItems.Remove(product);
    }
}
