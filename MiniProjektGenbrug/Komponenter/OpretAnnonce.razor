@page "/opretAnnonce"
@inject NavigationManager navMan
@using MiniProjektGenbrug.Services.Interfaces
@inject IProductService ProductService
@using Core

<h3>Tilføj ny annonce</h3>

@if (newAd != null)
{
    <EditForm Model="newAd" OnValidSubmit="AddAd">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="form-grid">
            <div class="form-item">
                <label>Pris:</label>
                <InputText placeholder="Indsat pris.." @bind-Value="newAd.Price" />
            </div>

            <div class="form-item">
                <label>Varenavn:</label>
                <InputText placeholder="Varenavn.." @bind-Value="newAd.Name" />
            </div>

            <div class="form-item">
                <label>Lokale:</label>
                <InputSelect @bind-Value="newAd.Room">
                    <option disabled selected>Vælg lokale</option>
                    @foreach (var r in Room)
                    {
                        <option>@r</option>
                    }
                </InputSelect>
            </div>

            <div class="form-item">
                <label>Kategori:</label>
                <InputSelect @bind-Value="newAd.Category">
                    <option disabled selected>Vælg kategori</option>
                    @foreach (var c in Categories)
                    {
                        <option>@c</option>
                    }
                </InputSelect>
            </div>

            <div class="form-item">
                <label>Farve:</label>
                <InputText @bind-Value="newAd.Color" />
            </div>

            <div class="form-item">
                <label>Størrelse:</label>
                <InputSelect @bind-Value="newAd.Size">
                    <option disabled selected>Vælg størrelse</option>
                    @foreach (var s in Sizes)
                    {
                        <option>@s</option>
                    }
                </InputSelect>
            </div>

            <div class="form-item full-width">
                <label>Beskrivelse:</label>
                <InputTextArea @bind-Value="newAd.Description" />
            </div>

            <div class="form-item">
                <label>Billede:</label>
                <InputFile OnChange="HandleImageUpload" />
            </div>

            <div class="form-item">
                <button type="submit">Tilføj annonce</button>
            </div>
        </div>
    </EditForm>
}

@code {
    private AdModel newAd = new();

    private List<string> Room = new() { "A101", "A102", "A103", "A104", "A105", "A106", "A107", "A108", "A109", "A110" };
    private List<string> Categories = new() { "Bukser", "T-shirt", "Sko", "Sweater", "Nederdel", "Kjole", "Jakke" };

    private List<string> ClothingSizes = new() { "XS", "S", "M", "L", "XL", "XXL", "XXXL"};
    private List<string> ShoeSizes = new() { "36", "37", "38", "39", "40", "41", "42", "43", "44", "45", "46" };

    private List<string> Sizes => newAd.Category == "Sko" ? ShoeSizes : ClothingSizes;

    private async Task AddAd()
    {
        var newProduct = new Product
        {
            Price = Convert.ToDouble(newAd.Price),
            Productname = newAd.Name,
            Category = newAd.Category,
            Color = newAd.Color,
            Size = newAd.Size,
            Description = newAd.Description,
            Status = "Available",
            BuyerId = null,
            Picture = newAd.Picture
        };

        ProductService.AddProduct(newProduct);

        Console.WriteLine("Annonce tilføjet:");
        Console.WriteLine($"{newAd.Name} - {newAd.Price} - {newAd.Category}");

        navMan.NavigateTo("/alleannoncer");
    }

    private async Task HandleImageUpload(InputFileChangeEventArgs e)
    {
        var file = e.File;
        if (file != null)
        {
            var filePath = "/images/" + file.Name;
            newAd.Picture = filePath;
            Console.WriteLine("Billede valgt: " + file.Name);
        }
    }

    public class AdModel
    {
        public string? Price { get; set; }
        public string? Name { get; set; }
        public string? Room { get; set; }
        public string? Category { get; set; }
        public string? Color { get; set; }
        public string? Size { get; set; }
        public string? Description { get; set; }
        public string? Picture { get; set; }
    }
}
